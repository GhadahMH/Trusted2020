<!DOCTYPE html>
<html>

<head>
    <title>Trusted Reviews</title>
  <script src="https://www.gstatic.com/firebasejs/5.5.6/firebase.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.8.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.8.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.8.0/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.8.0/firebase-storage.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="homePage.css">
<link rel="stylesheet" type="text/css" href="topFive.css">
<link rel="stylesheet" type="text/css" href="footer.css">
<link href= "https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.css" rel="stylesheet"/>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />
<link href="https://fonts.googleapis.com/css?family=Racing+Sans+One|Sirin+Stencil|Yatra+One&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/4.8.1/firebase.js"></script>
<script src="https://cdn.firebase.com/libs/firebaseui/2.5.1/firebaseui.js"></script>
<link rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/2.5.1/firebaseui.css" />
<link href="https://fonts.googleapis.com/css?family=Fredoka+One|Lalezar|Racing+Sans+One|Sirin+Stencil|Yatra+One&display=swap" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.2/animate.min.css">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css">
<link rel="stylesheet" type="text/css" href="https://themify.me/wp-content/themes/themify-v32/themify-icons/themify-icons.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
</head>


<body>
       <header class="main-header">
       <div class="header" >
       <img src="logo.png" class="webLogo">
  <!-- //////////////////////////////////// -->
        <div class="account">
        <button class="btn btn-secondary" id="sign-up" onclick="toggleSignUp()"><a>Sign Up</a></button>
        <button class="btn btn-secondary" id="sign-in" onclick="toggleLogin()"><a >Sign in</a></button>
        </div>

         <div class="overlay">
         <div class="login">
         <div class="header2">
           <h1>Sign in</h1>
           <i class="fas fa-times" onclick="toggleLogin()"></i>
         </div>
         <div class="newForm">
         <form action="#" class="form">
            <input type="text" id="LEmail" placeholder="Enter your Email" />
            <input type="password"  id="LPassword" placeholder="Enter your Password"/>
            <div class="loginbutton">
          <button onclick="Login()">Login</button>
          </br>
          </br>
          </br>
          <button class="btn" id="sign-up"><a>Sign in with google</a></button>
          </br>
          </br>
          </br>
          <button class="btn" id="sign-up"><a>Sign in with facebook</a></button>
          </br>
          </br>
          </br>
          </div>
         <h2>Forget Password?</h2>
          </form>
          </div>  

    </div> <!-- login closing tag -->
    </div> <!-- overlay closing tag -->

          <!--Register-->
         <div class="overlay2">
         <div class="login2">
         <div class="header2">
           <h1>Sign Up</h1>
           <i class="fas fa-times" onclick="toggleSignUp()"></i>
         </div>
          <div class="newForm2">
         <form action="#" class="form">
            <input type="text" id="FullName" placeholder="Full name" />
            <input type="text" id="Username" placeholder="Username" />
            <input type="text" id="SEmail" placeholder="Email" />
            <input type="text" id="SverifyEmail" placeholder="Verify Email" />
            <input type="password"  id="SPassword" placeholder="Password"/>
            <input type="password"  id="SVPassword" placeholder="Verify Password"/>
            <div class="SignUpbutton">
            <button onclick="Register()">Register</button>
          </div>
          </form>

          
          </div>  
    </div> <!-- login closing tag -->
    </div> <!-- overlay closing tag -->
    </div> <!-- Header closing tag -->

<!----->
         <nav class="main-nav">
         <ul>
            <li id="navPropertyOwner" style="display: none;"><a href="propertyOwnerDashboard.html"> Maneg Properties</a></li>
            <li><a href="HolidayHomes.html" style="color: grey; text-decoration: none;"> Holiday Homes</a></li>
            <li><a href="Login.html" style="color: grey; text-decoration: none;">Sign In</a></li>
            <li><a  href="MemberDashboard.html" style="color: grey; text-decoration: none;"> profile</a></li>
            <li><a  href="Memberregisteration.html" style="color: grey; text-decoration: none;"> register</a></li>
         </ul>
         </nav>
  </header>

<section class="hero">
  <h2>TRUSTED REVIEWS</h2>
  <p>Search for Variety of Holiday Homes<Br> on the Trusted Review website <Br> under blockchain technology development</p>
   <input type="text" id="Search" class="searchBox" placeholder="search for a holiday home">
   <button id="button_1" class="searchBtn">Search</button>
</section>



      <div class="search">

      </div>
    <div class="topFive">
      <h1 class="sectionTitel">Top Five Holiday Homes</h1>
      
<!-- test to five -->

</br>
</br>

<div id="topFiveRow" class="topFiveRow">

<section class="container">
    <div class="row active-with-click">
        <div class="col-md-4 col-sm-6 col-xs-12">
            <article class="material-card Blue-Grey">
                <h2>
                    <span id="PropName"></span>
                    <strong>
                        <i class="fa fa-fw fa-star" id="RatePropStar"></i>
                    </strong>
                </h2>
                <div class="mc-content">
                    <div class="img-container">
                        <img class="img-responsive" id="PropImg">
                    </div>
                    <div class="mc-description" id="PropDesc">
                    </div>
                </div>
                <a class="mc-btn-action">
                    <i class="fa fa-bars"></i>
                </a>
            </article>
        </div>
      </div>
    </section>

        
      </div>
    </div>

    <div class="topThree">
      <h1 class="sectionTitel"> Top Three Reviews</h1>
      <h2 class="topThreeIntro" >The displayed reviews are based on highest rated reviews and Thiqah Credit.</h2>
      <div id="TopThreeRow" class="TopThreeRow">

        
        
          

      </div>
</div>
<!---->
<div class="TrustedR">
  <h1 class="sectionTitel"> Trusted Reviews Features</h1> 
  <div class="TrustedRRow">
    <div class="singleTrustedR">
      <div class="row4">
        <img src="https://www.bitgild.com/wp-content/uploads/2020/01/1-oz-krugerrand-gold-coin-2020-1.png" style="width: 150px; height:150px; margin:auto"/>
        <div class="Tright">
          <h1 style="margin-bottom:5%;color:rgb(48, 0, 149)">Thiqa Credit Points</h1>
          <h3 style="font-size: 23px;">Earn your Thiqa credite points by sharing your reviews with trusted reviews commyonity</h3>
        </div>
      </div>
    </div>

    <div class="singleTrustedR">
      <div class="row4">
        <img src="https://www.bitgild.com/wp-content/uploads/2020/01/1-oz-krugerrand-gold-coin-2020-1.png" style="width: 150px; height:150px; margin:auto"/>
        <div class="Tright">
          <h1 style="margin-bottom:5%;color:rgb(48, 0, 149)">Blockchain History</h1>
          <h3 style="font-size: 23px;">To achieve transparency ,you can view our Blockchain at any given time</h3>
        </div>
      </div>
    </div>
    <!---->
    <div class="singleTrustedR">
      <div class="row4">
        <img src="https://www.bitgild.com/wp-content/uploads/2020/01/1-oz-krugerrand-gold-coin-2020-1.png" style="width: 150px; height:150px; margin:auto"/>
        <div class="Tright">
          <h1 style="margin-bottom:5%;color:rgb(48, 0, 149)">Trusted Reviews</h1>
          <h3 style="font-size: 23px;">Through the deployment of blockchain technology on our reviewing system, we guarantee delivering to you trusted reviews</h3>
        </div>
      </div>
    </div>

    <div class="singleTrustedR">
      <div class="row4">
        
        <div class="Tright">
          <h1 style="margin-bottom:5%;color:rgb(48, 0, 149)">Find Highly Recommended Hotel</h1>
          <h3 style="font-size: 23px;">With the availability of trusted reviews, you will be able to find a sutitable hotel for you</h3>
        </div>
      </div>
    </div>
</div>
</div>


<footer class="new_footer_area bg_color">
            <div class="new_footer_top">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-3 col-md-6">
                            <div class="f_widget company_widget wow fadeInLeft" data-wow-delay="0.2s" style="visibility: visible; animation-delay: 0.2s; animation-name: fadeInLeft;">
                                <h3 class="f-title f_600 t_color f_size_18">Get in Touch</h3>
                                <p>Don’t miss any updates of our new templates and extensions.!</p>
                                <form action="#" class="f_subscribe_two mailchimp" method="post" novalidate="true" _lpchecked="1">
                                    <input type="text" name="EMAIL" class="form-control memail" placeholder="Email">
                                    <button class="btn btn_get btn_get_two" type="submit">Subscribe</button>
                                    <p class="mchimp-errmessage" style="display: none;"></p>
                                    <p class="mchimp-sucmessage" style="display: none;"></p>
                                </form>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6">
                            <div class="f_widget about-widget pl_70 wow fadeInLeft" data-wow-delay="0.4s" style="visibility: visible; animation-delay: 0.4s; animation-name: fadeInLeft;">
                                <h3 class="f-title f_600 t_color f_size_18">Download</h3>
                                <ul class="list-unstyled f_list">
                                    <li><a href="#">Company</a></li>
                                    <li><a href="#">Android App</a></li>
                                    <li><a href="#">ios App</a></li>
                                    <li><a href="#">Desktop</a></li>
                                    <li><a href="#">Projects</a></li>
                                    <li><a href="#">My tasks</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6">
                            <div class="f_widget about-widget pl_70 wow fadeInLeft" data-wow-delay="0.6s" style="visibility: visible; animation-delay: 0.6s; animation-name: fadeInLeft;">
                                <h3 class="f-title f_600 t_color f_size_18">Help</h3>
                                <ul class="list-unstyled f_list">
                                    <li><a href="#">FAQ</a></li>
                                    <li><a href="#">Term &amp; conditions</a></li>
                                    <li><a href="#">Reporting</a></li>
                                    <li><a href="#">Documentation</a></li>
                                    <li><a href="#">Support Policy</a></li>
                                    <li><a href="#">Privacy</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6">
                            <div class="f_widget social-widget pl_70 wow fadeInLeft" data-wow-delay="0.8s" style="visibility: visible; animation-delay: 0.8s; animation-name: fadeInLeft;">
                                <h3 class="f-title f_600 t_color f_size_18">Team Solutions</h3>
                                <div class="f_social_icon">
                                    <a href="#" class="fab fa-facebook"></a>
                                    <a href="#" class="fab fa-twitter"></a>
                                    <a href="#" class="fab fa-linkedin"></a>
                                    <a href="#" class="fab fa-pinterest"></a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="footer_bg">
                    <div class="footer_bg_one"></div>
                    <div class="footer_bg_two"></div>
                </div>
            </div>
            <div class="footer_bottom">
                <div class="container">
                    <div class="row align-items-center">
                        <div class="col-lg-6 col-sm-7">
                            <p class="mb-0 f_400">© cakecounter Inc.. 2019 All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </footer>

    </body> 

<script>
// Your web app's Firebase configuration
var firebaseConfig = {
  apiKey: "AIzaSyBVKHsqnVyaPbvPmgzPqEK_9p2Hm4ZucYc",
  authDomain: "trusted2020-8c803.firebaseapp.com",
  databaseURL: "https://trusted2020-8c803.firebaseio.com",
  projectId: "trusted2020-8c803",
  storageBucket: "trusted2020-8c803.appspot.com",
  messagingSenderId: "662663714362",
  appId: "1:662663714362:web:1842f051b9bddf5f48c703",
  measurementId: "G-QDZ39S220R"
};
// Initialize Firebase
firebase.initializeApp(firebaseConfig);
//firebase.analytics();
var uu = sessionStorage.getItem('userId22');
          
if(uu!=null)
{
   document.getElementById('signin').style.display='none';
   document.getElementById('signout').style.display='block';
}else
{
  
 document.getElementById('signin').style.display='block';
 document.getElementById('signout').style.display='none';
 
}

firebase.auth.Auth.Persistence.LOCAL;
</script>

<script>

function Login(){
      var email = document.getElementById('LEmail').value;
        var password = document.getElementById('LPassword').value;
       if (email.length < 4) {
        window.alert('Please enter an email address.');
        return;
      }
       if (password.length < 4) {
        window.alert('Please enter a password.');
        return;
      }
    var result = firebase.auth().signInWithEmailAndPassword(email , password);
    result.then( function(user){
      var currentUser = firebase.auth().currentUser
      window.alert("Welcom3 Backe: "+currentUser.email);
     // writeCookie('user',currentUser,7);
     sessionStorage.setItem('userId22',currentUser.uid);
     if(currentUser.uid != null){
    firebase.database().ref('MEMBER').child(currentUser.uid).once('value').then(function(snapshot) {
    var userinfo = snapshot.val(); 
    var isOwner=userinfo['PropertyOwner'];

  if(isOwner){
    window.location.href = "propertyOwnerDashboard.html";  
  }else {
    window.location.href = "HomePage2.html";
  }
})
   }// currentUser Line#128
  auth = user;
  })
  .catch(function(error){
  alert("Login Failed!", error);
  });
}
function writeCookie(name,value,days) {
  var date, expires;
  if (days) {
      date = new Date();
      date.setTime(date.getTime()+(days*24*60*60*1000));
      expires = "; expires=" + date.toGMTString();
          }else{
      expires = "";
  }
  document.cookie = name + "=" + value + expires + "; path=/";
}


////////////Register///////////

function Register(){

var Pemail = document.getElementById('PEmail').value;
var Ppassword = document.getElementById('PPassword').value;
var PVpassprd=document.getElementById('PVerifyPassword').value;
var Pvemail=document.getElementById('PVerifyEmail').value;
if (Pemail.length < 4) {
 window.alert('Please enter an email address.');
 return;
}
if (Ppassword.length < 4) {
 window.alert('Please enter a password.');
 return;
}
if(Pemail!=Pvemail){
window.alert('Email and verifyEmail does not match ');
return;}
if(Ppassword!=PVpassprd){
window.alert('Password and VerifyPassword does not match ')
return;}
// Create user with email and pass.
// [START createwithemail]

firebase.auth().createUserWithEmailAndPassword(Pemail, Ppassword).then(function(user){ 
  firebase.auth().currentUser.sendEmailVerification();
  firebase.database().ref("MEMBER").child(firebase.auth().currentUser.uid,).set({
    MID :firebase.auth().currentUser.uid,
    FullName:document.getElementById('PFullName').value,
    Username:document.getElementById('PUsername').value,
    Email:document.getElementById('PEmail').value,
    PropertyOwner:true
});
window.alert('congrats'); 


}).catch(function(error) {
  // Handle Errors here.
  var errorCode = error.code;
  var errorMessage = error.message;
  // [START_EXCLUDE]
  if (errorCode == 'auth/weak-password') {
    alert('The password is too weak.');   
  } else {
    alert(errorMessage); 
  }
  console.log(error);
  // [END_EXCLUDE]
});


document.getElementById('PPassword').value = "";
document.getElementById('PVerifyPassword').value= "";
return;
}
//************ Top Five Home ***************
var PIDList=[];
var PIDListCopy=[];
var PRateList=[];
var PRateListCopy=[];
var PReviewsCountList=[];
var TopFive=[];
var i0=0;
var j0=0;
var k=0;
firebase.database().ref("Property").once('value').then(function (POwnerList0){
  POwnerList0.forEach(function (Owner0){
    
    firebase.database().ref("Property").child(Owner0.key).once('value').then(function (PropertyList0){
      i0++;
      j0=0;
      PropertyList0.forEach(function(Property0){
        j0++;
        PIDList.push( Property0.key);
       
        if(i0===POwnerList0.numChildren()&& j0===PropertyList0.numChildren())
        {
          for(var i1=0;i1<PIDList.length;i1++)
          { PRateList.push(0);
            PReviewsCountList.push(0);
            firebase.database().ref("Reviews").orderByChild('PID').equalTo(PIDList[i1]).once('value').then(function (ReviewList0){
              var rate=0;
              var j1=0
               
              if(ReviewList0.val()!=null)
              {
                ReviewList0.forEach(function (Review0){
                  rate+= parseInt(Review0.val().Rate);
                  j1++;
                  
                  if(j1===ReviewList0.numChildren())
                  {rate=rate/j1;
                    PRateList[PIDList.indexOf(Review0.val().PID)]=rate;
                    PReviewsCountList[PIDList.indexOf(Review0.val().PID)]=j1;
                  }
                });
              }
              k++; 
              
              if(k===PIDList.length)
                {
                  PIDListCopy=PIDList.slice();
                  PRateListCopy=PRateList.slice();
                  
                  for(var k1=0;k1<5;k1++)
                  {
                    maxH=Math.max.apply(null,PRateList);
                    TopFive.push(PIDList[PRateList.indexOf(maxH)]);
                    
                    PIDList.splice(PRateList.indexOf(maxH), 1);
                    PRateList.splice(PRateList.indexOf(maxH), 1);
                    //alert(PIDList[k1]+" : " +PRateList[k1]);
                  }
                   var c2=0
                  for(var c1=0;c1<TopFive.length;c1++)
                  {
                    firebase.database().ref("Property").once('value').then(function(snapshot){
                      snapshot.forEach(function (user){
                        user.forEach(function (property){
                          if(property.key===TopFive[c2])
                          {
                            
                            c2++;
                            document.getElementById('topFiveRow').innerHTML+=

                            '<div class="card__title" onClick="openProperty(\''+property.key+'\')">'+
                              '<h3 class="card__title" style="margin-top: 10px;">'+property.val().PropertyName+'</h3>'+
                              '<img src="'+property.val().Image+'" class="card__img"/>'+
                              '<div class="row1">'+
                                '<div class="d">'+
                                  '<div class="row2"><Span class=" fa fa-star " style="margin-right: 10px; color:gold"></Span><h3>'+PRateListCopy[PIDListCopy.indexOf(property.key)]+' Stars</h3>  </div>'+
                                  '<div class="row2">'+
                                  '<Span class="fa fa-clipboard" style="margin-right: 10px;display:flex"> <h3 style="margin-left: 10px;">'+PReviewsCountList[PIDListCopy.indexOf(property.key)]+' Reviws</h3> </Span>'+
                                  '</div>'+
                                '</div>'+
                                '<img class="placeImage" src="https://images.vexels.com/media/users/3/129154/isolated/preview/a9b2c4b91e649bf6c2b7de555015d668-1st-place-laurel-medal-by-vexels.png" />'+
                              '</div>'+
                            '</div>';
                          } });}); }); }}});}}});});});}); // close parentheses
function openProperty(pkey){
  window.location.href="SingleHolidayHome.html?p="+pkey;

}

//************ Top Three Review ***************
var topThree= [];
var idList = [];
var scoreList = [];
firebase.database().ref("Reviews").once('value').then(function (snapshot){
  var rCount=snapshot.numChildren();
  var j=0;
  snapshot.forEach(function (review){
    var rKey=review.key;
    var rLike=review.val().Like;
    var Lkeys = Object.keys(rLike);
    var likeCount=Lkeys.length
    var rDislike=review.val().Dislike;
    var Dkeys = Object.keys(rDislike);
    var dislikeCount=Dkeys.length;
    var score=likeCount-dislikeCount;
    idList.push(rKey);
    scoreList.push(score);
    j++
    if(j===rCount)
    {
      for(var i=0;i<3&&i<=j;i++)
      {
        
        var max=Math.max.apply(null,scoreList);
        topThree.push(idList[scoreList.indexOf(max)]);
       
        idList.splice(scoreList.indexOf(max), 1);
        scoreList.splice(scoreList.indexOf(max), 1);
      }
      for(var c=0;c<topThree.length;c++)
      {
        firebase.database().ref("Reviews").child(topThree[c]).once('value').then(function (R){
         
          firebase.database().ref("MEMBER").child(R.val().UID).once('value').then(function (M){

            firebase.database().ref("Property").once('value').then(function (POwnerList){
              POwnerList.forEach(function (pOwner){
                firebase.database().ref("Property").child(pOwner.key).child(R.val().PID).once('value').then(function(P){
                  
                    if(P.val()!=null){
                      document.getElementById('TopThreeRow').innerHTML+=

                      '<div class="singelTopThree">'+
                        '<div class="row3">'+
                          '<img class="ReviewerImg" src="https://www.jumpstarttech.com/files/2018/08/Network-Profile.png"/>'+
                          '<div class="RHead">'+
                            '<h2 style="margin-bottom: 20px;">'+M.val().FullName+'</h2>'+
                            '<h3>'+P.val().PropertyName+'</h3>'+
                            '<h3>'+P.val().City+'</h3>'+
                          '</div>'+
                        '</div>'+
                        '<P style="height: 180px;">'+R.val().Txt+'</P>'+
                        '<div class="Rfooter">'+
                          '<h3 style="margin: auto;">'+R.val().DateTime+'</h3>'+
                          '<div class="blockchain">'+
                            '<h3 style="margin: auto;">Blockchain</h3>'+
                            '<img style="width: 50px;height:50px" src="https://cdn0.iconfinder.com/data/icons/basic-uses-symbol-vol-3/100/Security_Shield_Secure_Risk_True_Yes_Right-512.png">'+
                          '</div>'+
                        '</div>'+
                      '</div>'
                    }
                }); });}); });}); } }});});


function logout()
         {
          sessionStorage.removeItem('userId22');
          window.location.href = "HomePage2.html"
         }
</script>


<script type="text/javascript">
   function toggleLogin() {
      document.querySelector(".overlay").classList.toggle("open");
    }
    function toggleSignUp() {
      document.querySelector(".overlay2").classList.toggle("open");
    }
</script>



<!-- for the cards (TopFive) -->
<script>
  $(function() {
        $('.material-card > .mc-btn-action').click(function () {
            var card = $(this).parent('.material-card');
            var icon = $(this).children('i');
            icon.addClass('fa-spin-fast');

            if (card.hasClass('mc-active')) {
                card.removeClass('mc-active');

                window.setTimeout(function() {
                    icon
                        .removeClass('fa-arrow-left')
                        .removeClass('fa-spin-fast')
                        .addClass('fa-bars');

                }, 800);
            } else {
                card.addClass('mc-active');

                window.setTimeout(function() {
                    icon
                        .removeClass('fa-bars')
                        .removeClass('fa-spin-fast')
                        .addClass('fa-arrow-left');

                }, 800);
            }
        });
    });
  </script>

</body>
</html>